{
	"variables": [],
	"info": {
		"name": "3-Tier-App",
		"_postman_id": "30f8d371-b842-b3c1-bba9-ddf4ecda6c56",
		"description": "",
		"schema": "https://schema.getpostman.com/json/collection/v2.0.0/collection.json"
	},
	"item": [
		{
			"name": "Patch - Create 3-Tier App Network",
			"request": {
				"url": "https://{{nsxmanager}}/policy/api/v1/infra/",
				"method": "PATCH",
				"header": [
					{
						"key": "Authorization",
						"value": "Basic YWRtaW46Vk13YXJlMSFWTXdhcmUxIQ==",
						"description": ""
					},
					{
						"key": "Content-Type",
						"value": "application/json",
						"description": ""
					},
					{
						"key": "Postman-Token",
						"value": "873c52d3-9759-44a2-bda7-becda0a96575",
						"description": ""
					},
					{
						"key": "cache-control",
						"value": "no-cache",
						"description": ""
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\r\n  \"resource_type\": \"Infra\",\r\n  \"children\": [\r\n    {\r\n      \"resource_type\": \"ChildTier1\",\r\n      \"marked_for_delete\": \"{{marked_for_delete}}\",\r\n      \"Tier1\": {\r\n        \"resource_type\": \"Tier1\",\r\n        \"id\": \"{{Tier1-name}}\",\r\n        \"tags\": [\r\n          {\r\n            \"scope\": \"{{scope-01}}\",\r\n            \"tag\": \"{{tag-01}}\"\r\n          },\r\n          {\r\n            \"scope\": \"{{scope-02}}\",\r\n            \"tag\": \"{{tag-02}}\"\r\n          }\r\n        ],\r\n        \"description\": \"{{Tier1-description}}\",\r\n        \"display_name\": \"{{Tier1-name}}\",\r\n        \"failover_mode\": \"{{Tier1-failover_mode}}\",\r\n        \"tier0_path\":\"/infra/tier-0s/{{Tier0-name}}\",\r\n        \"route_advertisement_types\": [\r\n          \"TIER1_LB_SNAT\",\r\n          \"TIER1_NAT\",\r\n          \"TIER1_CONNECTED\",\r\n          \"TIER1_LB_VIP\"\r\n        ],\r\n        \"children\": [\r\n          {\r\n           \"resource_type\":\"ChildLocaleServices\",\r\n           \"LocaleServices\":{\r\n               \"resource_type\":\"LocaleServices\",\r\n               \"id\":  \"{{domain_id}}\",\r\n               \"marked_for_delete\": \"{{marked_for_delete}}\",\r\n               \"tags\": [\r\n                 {\r\n                   \"scope\": \"{{scope-01}}\",\r\n                   \"tag\": \"{{tag-01}}\"\r\n                 },\r\n                 {\r\n                   \"scope\": \"{{scope-02}}\",\r\n                   \"tag\": \"{{tag-02}}\"\r\n                 }\r\n               ],\r\n                \"edge_cluster_path\": \"/infra/sites/default/enforcement-points/default/edge-clusters/{{edge-cluster-id}}\"\r\n                }\r\n        },\r\n          {\r\n            \"resource_type\": \"ChildSegment\",\r\n            \"Segment\": {\r\n              \"resource_type\": \"Segment\",\r\n              \"id\": \"{{Segment1-id}}\",\r\n              \"tags\": [\r\n                {\r\n                  \"scope\": \"{{scope-01}}\",\r\n                  \"tag\": \"{{tag-01}}\"\r\n                },\r\n                {\r\n                  \"scope\": \"{{scope-02}}\",\r\n                  \"tag\": \"{{tag-02}}\"\r\n                }\r\n              ],\r\n              \"description\": \"{{Segment1-description}}\",\r\n              \"display_name\": \"{{Segment1-id}}\",\r\n              \"transport_zone_path\": \"/infra/sites/default/enforcement-points/default/transport-zones/{{Segment-TZid}}\",\r\n              \"subnets\": [\r\n                {\r\n                  \"gateway_address\": \"{{Segment1-gw}}\"\r\n                }\r\n              ]\r\n            }\r\n          },\r\n          {\r\n            \"resource_type\": \"ChildSegment\",\r\n            \"Segment\": {\r\n              \"resource_type\": \"Segment\",\r\n              \"id\": \"{{Segment2-id}}\",\r\n              \"tags\": [\r\n                {\r\n                  \"scope\": \"{{scope-01}}\",\r\n                  \"tag\": \"{{tag-01}}\"\r\n                },\r\n                {\r\n                  \"scope\": \"{{scope-02}}\",\r\n                  \"tag\": \"{{tag-02}}\"\r\n                }\r\n              ],\r\n              \"description\": \"{{Segment2-description}}\",\r\n              \"display_name\": \"{{Segment2-id}}\",\r\n              \"transport_zone_path\": \"/infra/sites/default/enforcement-points/default/transport-zones/{{Segment-TZid}}\",\r\n              \"subnets\": [\r\n                {\r\n                  \"gateway_address\": \"{{Segment2-gw}}\"\r\n                }\r\n              ]\r\n            }\r\n          },\r\n          {\r\n            \"resource_type\": \"ChildSegment\",\r\n            \"Segment\": {\r\n              \"resource_type\": \"Segment\",\r\n              \"id\": \"{{Segment3-id}}\",\r\n              \"tags\": [\r\n                {\r\n                  \"scope\": \"{{scope-01}}\",\r\n                  \"tag\": \"{{tag-01}}\"\r\n                },\r\n                {\r\n                  \"scope\": \"{{scope-02}}\",\r\n                  \"tag\": \"{{tag-02}}\"\r\n                }\r\n              ],\r\n              \"description\": \"{{Segment3-description}}\",\r\n              \"display_name\": \"{{Segment3-id}}\",\r\n              \"transport_zone_path\": \"/infra/sites/default/enforcement-points/default/transport-zones/{{Segment-TZid}}\",\r\n              \"subnets\": [\r\n                {\r\n                  \"gateway_address\": \"{{Segment3-gw}}\"\r\n                }\r\n              ]\r\n            }\r\n          }\r\n       ]\r\n      }\r\n    },\r\n    {\r\n      \"resource_type\": \"ChildDomain\",\r\n      \"marked_for_delete\": \"{{marked_for_delete}}\",\r\n      \"Domain\": {\r\n        \"id\": \"{{domain_id}}\",\r\n        \"tags\": [\r\n          {\r\n            \"scope\": \"{{scope-01}}\",\r\n            \"tag\": \"{{tag-01}}\"\r\n          },\r\n          {\r\n            \"scope\": \"{{scope-02}}\",\r\n            \"tag\": \"{{tag-02}}\"\r\n          }\r\n        ],\r\n        \"resource_type\": \"Domain\",\r\n        \"description\": \"{{domain_id}}\",\r\n        \"display_name\": \"{{domain_id}}\",\r\n        \"marked_for_delete\": \"{{marked_for_delete}}\",\r\n        \"children\": [\r\n          {\r\n            \"resource_type\": \"ChildGroup\",\r\n            \"Group\": {\r\n              \"resource_type\": \"Group\",\r\n              \"marked_for_delete\": \"{{marked_for_delete}}\",\r\n              \"description\": \"{{secgroup1-id}}\",\r\n              \"display_name\": \"{{secgroup1-id}}\",\r\n              \"id\": \"{{secgroup1-id}}\",\r\n              \"tags\": [\r\n                {\r\n                  \"scope\": \"{{scope-01}}\",\r\n                  \"tag\": \"{{tag-01}}\"\r\n                },\r\n                {\r\n                  \"scope\": \"{{scope-02}}\",\r\n                  \"tag\": \"{{tag-02}}\"\r\n                }\r\n              ],\r\n              \"expression\": [\r\n                {\r\n                  \"member_type\": \"VirtualMachine\",\r\n                  \"value\": \"{{scope}}|{{sectag1}}\",\r\n                  \"key\": \"Tag\",\r\n                  \"operator\": \"EQUALS\",\r\n                  \"resource_type\": \"Condition\"\r\n                }\r\n              ]\r\n            }\r\n          },\r\n          {\r\n            \"resource_type\": \"ChildGroup\",\r\n            \"Group\": {\r\n              \"resource_type\": \"Group\",\r\n              \"marked_for_delete\": \"{{marked_for_delete}}\",\r\n              \"description\": \"{{secgroup2-id}}\",\r\n              \"display_name\": \"{{secgroup2-id}}\",\r\n              \"id\": \"{{secgroup2-id}}\",\r\n              \"tags\": [\r\n                {\r\n                  \"scope\": \"{{scope-01}}\",\r\n                  \"tag\": \"{{tag-01}}\"\r\n                },\r\n                {\r\n                  \"scope\": \"{{scope-02}}\",\r\n                  \"tag\": \"{{tag-02}}\"\r\n                }\r\n              ],\r\n              \"expression\": [\r\n                {\r\n                  \"member_type\": \"VirtualMachine\",\r\n                  \"value\": \"{{scope}}|{{sectag2}}\",\r\n                  \"key\": \"Tag\",\r\n                  \"operator\": \"EQUALS\",\r\n                  \"resource_type\": \"Condition\"\r\n                }\r\n              ]\r\n            }\r\n          },\r\n          {\r\n            \"resource_type\": \"ChildGroup\",\r\n            \"Group\": {\r\n              \"resource_type\": \"Group\",\r\n              \"marked_for_delete\": \"{{marked_for_delete}}\",\r\n              \"description\": \"{{secgroup3-id}}\",\r\n              \"display_name\": \"{{secgroup3-id}}\",\r\n              \"id\": \"{{secgroup3-id}}\",\r\n              \"tags\": [\r\n                {\r\n                  \"scope\": \"{{scope-01}}\",\r\n                  \"tag\": \"{{tag-01}}\"\r\n                },\r\n                {\r\n                  \"scope\": \"{{scope-02}}\",\r\n                  \"tag\": \"{{tag-02}}\"\r\n                }\r\n              ],\r\n              \"expression\": [\r\n                {\r\n                  \"member_type\": \"VirtualMachine\",\r\n                  \"value\": \"{{scope}}|{{sectag3}}\",\r\n                  \"key\": \"Tag\",\r\n                  \"operator\": \"EQUALS\",\r\n                  \"resource_type\": \"Condition\"\r\n                }\r\n              ]\r\n            }\r\n          },\r\n          {\r\n            \"resource_type\": \"ChildGroup\",\r\n            \"Group\": {\r\n              \"resource_type\": \"Group\",\r\n              \"marked_for_delete\": \"{{marked_for_delete}}\",\r\n              \"description\": \"{{secgroupblanket-id}}\",\r\n              \"display_name\": \"{{secgroupblanket-id}}\",\r\n              \"id\": \"{{secgroupblanket-id}}\",\r\n              \"tags\": [\r\n                {\r\n                  \"scope\": \"{{scope-01}}\",\r\n                  \"tag\": \"{{tag-01}}\"\r\n                },\r\n                {\r\n                  \"scope\": \"{{scope-02}}\",\r\n                  \"tag\": \"{{tag-02}}\"\r\n                }\r\n              ],\r\n              \"expression\": [\r\n                {\r\n                  \"member_type\": \"VirtualMachine\",\r\n                  \"value\": \"{{scope}}|{{sectagblanket}}\",\r\n                  \"key\": \"Tag\",\r\n                  \"operator\": \"EQUALS\",\r\n                  \"resource_type\": \"Condition\"\r\n                }\r\n              ]\r\n            }\r\n          },\r\n          {\r\n            \"resource_type\": \"ChildSecurityPolicy\",\r\n            \"marked_for_delete\": \"{{marked_for_delete}}\",\r\n            \"SecurityPolicy\": {\r\n              \"id\": \"{{EW-securitypolicy-section-id}}\",\r\n              \"tags\": [\r\n                {\r\n                  \"scope\": \"{{scope-01}}\",\r\n                  \"tag\": \"{{tag-01}}\"\r\n                },\r\n                {\r\n                  \"scope\": \"{{scope-02}}\",\r\n                  \"tag\": \"{{tag-02}}\"\r\n                }\r\n              ],\r\n              \"resource_type\": \"SecurityPolicy\",\r\n              \"description\": \"communication map\",\r\n              \"display_name\": \"{{EW-securitypolicy-section-id}}\",\r\n              \"rules\": [\r\n                {\r\n                  \"resource_type\": \"Rule\",\r\n                  \"description\": \"Communication Entry\",\r\n                  \"display_name\": \"{{Rule1-id}}\",\r\n                  \"sequence_number\": 1,\r\n                  \"logged\": true,\r\n                  \"source_groups\": [\r\n                    \"ANY\"\r\n                  ],\r\n                  \"destination_groups\": [\r\n                    \"/infra/domains/{{domain_id}}/groups/{{secgroup1-id}}\"\r\n                  ],\r\n                  \"services\": [\r\n                    \"/infra/services/HTTP\",\r\n                    \"/infra/services/HTTPS\"\r\n                  ],\r\n                  \"scope\": [\r\n                    \"/infra/domains/{{domain_id}}/groups/{{secgroupblanket-id}}\"\r\n                  ],\r\n                  \"action\": \"ALLOW\"\r\n                },\r\n                {\r\n                  \"resource_type\": \"Rule\",\r\n                  \"description\": \"Communication Entry 2\",\r\n                  \"display_name\": \"{{Rule2-id}}\",\r\n                  \"sequence_number\": 2,\r\n                  \"logged\": true,\r\n                  \"source_groups\": [\r\n                    \"/infra/domains/{{domain_id}}/groups/{{secgroup1-id}}\"\r\n                  ],\r\n                  \"destination_groups\": [\r\n                    \"/infra/domains/{{domain_id}}/groups/{{secgroup2-id}}\"\r\n                  ],\r\n                  \"services\": [\r\n                    \"/infra/services/TCP_8443\"\r\n                  ],\r\n                  \"scope\": [\r\n                    \"/infra/domains/{{domain_id}}/groups/{{secgroupblanket-id}}\"\r\n                  ],\r\n                  \"action\": \"ALLOW\"\r\n                },\r\n                {\r\n                  \"resource_type\": \"Rule\",\r\n                  \"description\": \"Communication Entry 3\",\r\n                  \"display_name\": \"{{Rule3-id}}\",\r\n                  \"sequence_number\": 3,\r\n                  \"logged\": true,\r\n                  \"source_groups\": [\r\n                    \"/infra/domains/{{domain_id}}/groups/{{secgroup2-id}}\"\r\n                  ],\r\n                  \"destination_groups\": [\r\n                    \"/infra/domains/{{domain_id}}/groups/{{secgroup3-id}}\"\r\n                  ],\r\n                  \"services\": [\r\n                    \"/infra/services/MySQL\"\r\n                  ],\r\n                  \"scope\": [\r\n                    \"/infra/domains/{{domain_id}}/groups/{{secgroupblanket-id}}\"\r\n                  ],\r\n                  \"action\": \"ALLOW\"\r\n                }\r\n              ]\r\n            }\r\n          }\r\n          ]\r\n        }\r\n    },\r\n    {\r\n      \"resource_type\": \"ChildLBAppProfile\",\r\n      \"LBAppProfile\": {\r\n        \"resource_type\": \"LBHttpProfile\",\r\n        \"id\": \"batchSetupHttpAppProfile\",\r\n        \"marked_for_delete\": \"{{marked_for_delete}}\",\r\n        \"tags\": [\r\n          {\r\n            \"scope\": \"{{scope-01}}\",\r\n            \"tag\": \"{{tag-01}}\"\r\n          },\r\n          {\r\n            \"scope\": \"{{scope-02}}\",\r\n            \"tag\": \"{{tag-02}}\"\r\n          }\r\n        ],\r\n        \"x_forwarded_for\": \"INSERT\"\r\n      }\r\n    },\r\n    {\r\n      \"resource_type\": \"ChildLBService\",\r\n      \"LBService\": {\r\n        \"resource_type\": \"LBService\",\r\n        \"id\": \"{{lb-id}}\",\r\n        \"marked_for_delete\": \"{{marked_for_delete}}\",\r\n        \"tags\": [\r\n          {\r\n            \"scope\": \"{{scope-01}}\",\r\n            \"tag\": \"{{tag-01}}\"\r\n          },\r\n          {\r\n            \"scope\": \"{{scope-02}}\",\r\n            \"tag\": \"{{tag-02}}\"\r\n          }\r\n        ],\r\n        \"connectivity_path\": \"/infra/tier-1s/{{Tier1-name}}\",\r\n        \"error_log_level\": \"DEBUG\",\r\n        \"access_log_enabled\": true\r\n      }\r\n    },\r\n    {\r\n      \"resource_type\": \"ChildLBVirtualServer\",\r\n      \"LBVirtualServer\": {\r\n        \"resource_type\": \"LBVirtualServer\",\r\n        \"id\": \"{{vs-id}}\",\r\n        \"marked_for_delete\": \"{{marked_for_delete}}\",\r\n        \"tags\": [\r\n          {\r\n            \"scope\": \"{{scope-01}}\",\r\n            \"tag\": \"{{tag-01}}\"\r\n          },\r\n          {\r\n            \"scope\": \"{{scope-02}}\",\r\n            \"tag\": \"{{tag-02}}\"\r\n          }\r\n        ],\r\n        \"lb_service_path\": \"/infra/lb-services/{{lb-id}}\",\r\n        \"ip_address\": \"{{vs-ip}}\",\r\n        \"ports\": [\r\n          \"443\"\r\n        ],\r\n        \"pool_path\": \"/infra/lb-pools/{{pool-id}}\",\r\n        \"application_profile_path\": \"/infra/lb-app-profiles/default-tcp-lb-app-profile\"\r\n        }\r\n      },\r\n    {\r\n      \"resource_type\": \"ChildLBPool\",\r\n      \"LBPool\":\r\n      {\r\n        \"id\": \"{{pool-id}}\",\r\n        \"marked_for_delete\": \"{{marked_for_delete}}\",\r\n        \"tags\": [\r\n          {\r\n            \"scope\": \"{{scope-01}}\",\r\n            \"tag\": \"{{tag-01}}\"\r\n          },\r\n          {\r\n            \"scope\": \"{{scope-02}}\",\r\n            \"tag\": \"{{tag-02}}\"\r\n          }\r\n        ],\r\n        \"resource_type\": \"LBPool\",\r\n        \"active_monitor_paths\": [\r\n          \"/infra/lb-monitor-profiles/default-https-lb-monitor\"\r\n        ],\r\n            \"algorithm\": \"ROUND_ROBIN\",\r\n            \"member_group\": {\r\n                \"group_path\": \"/infra/domains/{{domain_id}}/groups/{{secgroup1-id}}\",\r\n                \"ip_revision_filter\": \"IPV4\"\r\n            },\r\n            \"snat_translation\": {\r\n                \"type\": \"LBSnatAutoMap\"\r\n            }\r\n      }\r\n    }\r\n  ]\r\n}\r\n"
				},
				"description": ""
			},
			"response": []
		}
	]
}