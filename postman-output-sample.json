PATCH /policy/api/v1/infra/ HTTP/1.1
Host: nsxapp-02a.corp.local:44321
Authorization: Basic YWRtaW46QWRtaW4hMjNBZG1pbg==,Basic YWRtaW46Vk13YXJlMSFWTXdhcmUxIQ==
Content-Type: application/json
Postman-Token: 873c52d3-9759-44a2-bda7-becda0a96575,adeb8f3a-0406-4724-89aa-6763e19be4fa
cache-control: no-cache,no-cache
User-Agent: PostmanRuntime/7.19.0
Accept: */*
Host: nsxapp-02a.corp.local:44321
Accept-Encoding: gzip, deflate
Content-Length: 13556
Cookie: JSESSIONID=5DB990EC6EE05FEF4CD53079D25B4C9C
Connection: keep-alive

{
  "resource_type": "Infra",
  "children": [
    {
      "resource_type": "ChildTier1",
      "marked_for_delete": "false",
      "Tier1": {
        "resource_type": "Tier1",
        "id": "prod-tier-1-gw",
        "tags": [
          {
            "scope": "app",
            "tag": "3-tier"
          },
          {
            "scope": "env",
            "tag": "prod"
          }
        ],
        "description": "Created by Policy API",
        "display_name": "prod-tier-1-gw",
        "failover_mode": "NON_PREEMPTIVE",
        "tier0_path":"/infra/tier-0s/Tier-0-GW",
        "route_advertisement_types": [
          "TIER1_LB_SNAT",
          "TIER1_NAT",
          "TIER1_CONNECTED",
          "TIER1_LB_VIP"
        ],
        "children": [
          {
           "resource_type":"ChildLocaleServices",
           "LocaleServices":{
               "resource_type":"LocaleServices",
               "id":  "default",
               "marked_for_delete": "false",
               "tags": [
                 {
                   "scope": "app",
                   "tag": "3-tier"
                 },
                 {
                   "scope": "env",
                   "tag": "prod"
                 }
               ],
                "edge_cluster_path": "/infra/sites/default/enforcement-points/default/edge-clusters/ec6f2915-c5a5-45b0-8f9c-ec6dadb692a6"
                }
        },
          {
            "resource_type": "ChildSegment",
            "Segment": {
              "resource_type": "Segment",
              "id": "PROD-WEB-Segment",
              "tags": [
                {
                  "scope": "app",
                  "tag": "3-tier"
                },
                {
                  "scope": "env",
                  "tag": "prod"
                }
              ],
              "description": "Created by Policy API",
              "display_name": "PROD-WEB-Segment",
              "transport_zone_path": "/infra/sites/default/enforcement-points/default/transport-zones/cff37dc1-3a76-423a-a326-d990f5cc814d",
              "subnets": [
                {
                  "gateway_address": "172.16.10.1/24"
                }
              ]
            }
          },
          {
            "resource_type": "ChildSegment",
            "Segment": {
              "resource_type": "Segment",
              "id": "PROD-APP-Segment",
              "tags": [
                {
                  "scope": "app",
                  "tag": "3-tier"
                },
                {
                  "scope": "env",
                  "tag": "prod"
                }
              ],
              "description": "Created by Policy API",
              "display_name": "PROD-APP-Segment",
              "transport_zone_path": "/infra/sites/default/enforcement-points/default/transport-zones/cff37dc1-3a76-423a-a326-d990f5cc814d",
              "subnets": [
                {
                  "gateway_address": "172.16.20.1/24"
                }
              ]
            }
          },
          {
            "resource_type": "ChildSegment",
            "Segment": {
              "resource_type": "Segment",
              "id": "PROD-DB-Segment",
              "tags": [
                {
                  "scope": "app",
                  "tag": "3-tier"
                },
                {
                  "scope": "env",
                  "tag": "prod"
                }
              ],
              "description": "Created by Policy API",
              "display_name": "PROD-DB-Segment",
              "transport_zone_path": "/infra/sites/default/enforcement-points/default/transport-zones/cff37dc1-3a76-423a-a326-d990f5cc814d",
              "subnets": [
                {
                  "gateway_address": "172.16.30.1/24"
                }
              ]
            }
          }
       ]
      }
    },
    {
      "resource_type": "ChildDomain",
      "marked_for_delete": "false",
      "Domain": {
        "id": "default",
        "tags": [
          {
            "scope": "app",
            "tag": "3-tier"
          },
          {
            "scope": "env",
            "tag": "prod"
          }
        ],
        "resource_type": "Domain",
        "description": "default",
        "display_name": "default",
        "marked_for_delete": "false",
        "children": [
          {
            "resource_type": "ChildGroup",
            "Group": {
              "resource_type": "Group",
              "marked_for_delete": "false",
              "description": "prod-web-vms",
              "display_name": "prod-web-vms",
              "id": "prod-web-vms",
              "tags": [
                {
                  "scope": "app",
                  "tag": "3-tier"
                },
                {
                  "scope": "env",
                  "tag": "prod"
                }
              ],
              "expression": [
                {
                  "member_type": "VirtualMachine",
                  "value": "secgroup|prodweb",
                  "key": "Tag",
                  "operator": "EQUALS",
                  "resource_type": "Condition"
                }
              ]
            }
          },
          {
            "resource_type": "ChildGroup",
            "Group": {
              "resource_type": "Group",
              "marked_for_delete": "false",
              "description": "prod-app-vms",
              "display_name": "prod-app-vms",
              "id": "prod-app-vms",
              "tags": [
                {
                  "scope": "app",
                  "tag": "3-tier"
                },
                {
                  "scope": "env",
                  "tag": "prod"
                }
              ],
              "expression": [
                {
                  "member_type": "VirtualMachine",
                  "value": "secgroup|prodapp",
                  "key": "Tag",
                  "operator": "EQUALS",
                  "resource_type": "Condition"
                }
              ]
            }
          },
          {
            "resource_type": "ChildGroup",
            "Group": {
              "resource_type": "Group",
              "marked_for_delete": "false",
              "description": "prod-db-vms",
              "display_name": "prod-db-vms",
              "id": "prod-db-vms",
              "tags": [
                {
                  "scope": "app",
                  "tag": "3-tier"
                },
                {
                  "scope": "env",
                  "tag": "prod"
                }
              ],
              "expression": [
                {
                  "member_type": "VirtualMachine",
                  "value": "secgroup|proddb",
                  "key": "Tag",
                  "operator": "EQUALS",
                  "resource_type": "Condition"
                }
              ]
            }
          },
          {
            "resource_type": "ChildGroup",
            "Group": {
              "resource_type": "Group",
              "marked_for_delete": "false",
              "description": "prod-3tier-app",
              "display_name": "prod-3tier-app",
              "id": "prod-3tier-app",
              "tags": [
                {
                  "scope": "app",
                  "tag": "3-tier"
                },
                {
                  "scope": "env",
                  "tag": "prod"
                }
              ],
              "expression": [
                {
                  "member_type": "VirtualMachine",
                  "value": "secgroup|prod-3tier-app",
                  "key": "Tag",
                  "operator": "EQUALS",
                  "resource_type": "Condition"
                }
              ]
            }
          },
          {
            "resource_type": "ChildSecurityPolicy",
            "marked_for_delete": "false",
            "SecurityPolicy": {
              "id": "prod-3tier-app-policy",
              "tags": [
                {
                  "scope": "app",
                  "tag": "3-tier"
                },
                {
                  "scope": "env",
                  "tag": "prod"
                }
              ],
              "resource_type": "SecurityPolicy",
              "description": "communication map",
              "display_name": "prod-3tier-app-policy",
              "rules": [
                {
                  "resource_type": "Rule",
                  "description": "Communication Entry",
                  "display_name": "any-to-web",
                  "sequence_number": 1,
                  "logged": true,
                  "source_groups": [
                    "ANY"
                  ],
                  "destination_groups": [
                    "/infra/domains/default/groups/prod-web-vms"
                  ],
                  "services": [
                    "/infra/services/HTTP",
                    "/infra/services/HTTPS"
                  ],
                  "scope": [
                    "/infra/domains/default/groups/prod-3tier-app"
                  ],
                  "action": "ALLOW"
                },
                {
                  "resource_type": "Rule",
                  "description": "Communication Entry 2",
                  "display_name": "web-to-app",
                  "sequence_number": 2,
                  "logged": true,
                  "source_groups": [
                    "/infra/domains/default/groups/prod-web-vms"
                  ],
                  "destination_groups": [
                    "/infra/domains/default/groups/prod-app-vms"
                  ],
                  "services": [
                    "/infra/services/HTTP"
                  ],
                  "scope": [
                    "/infra/domains/default/groups/prod-3tier-app"
                  ],
                  "action": "ALLOW"
                },
                {
                  "resource_type": "Rule",
                  "description": "Communication Entry 3",
                  "display_name": "app-to-db",
                  "sequence_number": 3,
                  "logged": true,
                  "source_groups": [
                    "/infra/domains/default/groups/prod-app-vms"
                  ],
                  "destination_groups": [
                    "/infra/domains/default/groups/prod-db-vms"
                  ],
                  "services": [
                    "/infra/services/MySQL"
                  ],
                  "scope": [
                    "/infra/domains/default/groups/prod-3tier-app"
                  ],
                  "action": "ALLOW"
                }
              ]
            }
          },
          {
            "resource_type": "ChildGatewayPolicy",
            "marked_for_delete": "false",
            "GatewayPolicy": {
              "resource_type": "GatewayPolicy",
              "id": "prod-3tier-app",
              "tags": [
                {
                  "scope": "app",
                  "tag": "3-tier"
                },
                {
                  "scope": "env",
                  "tag": "prod"
                }
              ],
              "display_name": "prod-3tier-app",
              "parent_path": "/infra/domains/default",
              "marked_for_delete": "false",
              "rules": [
                {
                 "source_groups": [
                        "ANY"
                    ],
                    "destination_groups": [
                        "/infra/domains/default/groups/prod-web-vms"
                    ],
                    "services": [
                        "/infra/services/HTTP",
                        "/infra/services/HTTPS"
                    ],
                    "profiles": [
                        "ANY"
                    ],
                    "action": "ALLOW",
                    "logged": true,
                    "scope": [
                        "/infra/tier-1s/prod-tier-1-gw"
                    ],
                    "disabled": false,
                    "notes": "",
                    "direction": "IN_OUT",
                    "tag": "",
                    "ip_protocol": "IPV4_IPV6",
                    "resource_type": "Rule",
                    "id": "Any-to-web",
                    "display_name": "Any-to-web"
                },
                {
                 "source_groups": [
                        "ANY"
                    ],
                    "destination_groups": [
                        "/infra/domains/default/groups/prod-web-vms",
                        "/infra/domains/default/groups/prod-app-vms",
                        "/infra/domains/default/groups/prod-db-vms"
                    ],
                    "services": [
                        "ANY"
                    ],
                    "profiles": [
                        "ANY"
                    ],
                    "action": "DROP",
                    "logged": false,
                    "scope": [
                        "/infra/tier-1s/prod-tier-1-gw"
                    ],
                    "disabled": false,
                    "notes": "",
                    "direction": "IN_OUT",
                    "tag": "",
                    "ip_protocol": "IPV4_IPV6",
                    "resource_type": "Rule",
                    "id": "DenyAny",
                    "display_name": "DenyAny"
                }
               ]
            }
          }
          ]
        }
    }
  ]
}
